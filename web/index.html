<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MiniGPT</title>
</head>
<body style="margin:0; padding:16px; font-family: Arial, sans-serif;">
  <div style="padding:10px;border:1px solid #22c55e;margin-bottom:10px;border-radius:10px;">
    âœ… Mini App: backend ping + chat
  </div>

  <div id="chat" style="height:60vh; overflow:auto; border:1px solid #ccc; padding:10px; border-radius:10px;"></div>

  <div style="display:flex; gap:8px; margin-top:10px;">
    <input id="msg" style="flex:1; padding:10px; border:1px solid #ccc; border-radius:10px;" placeholder="ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ..." />
    <button id="send" style="padding:10px 16px; border:1px solid #ccc; border-radius:10px;">Send</button>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("msg");
    const send  = document.getElementById("send");

    function line(who, text) {
      const p = document.createElement("p");
      p.textContent = ${who}: ${text};
      p.style.margin = "6px 0";
      chat.appendChild(p);
      chat.scrollTop = chat.scrollHeight;
    }

    const tg = window.Telegram?.WebApp;
    if (tg) { tg.ready(); tg.expand(); line("system", "Telegram WebApp âœ…"); }
    else { line("system", "ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¾ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ"); }

    // âš ï¸ Ğ’Ğ¡Ğ¢ĞĞ’Ğ¬ Ğ¡Ğ®Ğ”Ğ Ğ¡Ğ’ĞĞ™ Render URL:
    const BACKEND = "https://tg-mini-gpt-backend.onrender.com";

    async function ping() {
      try {
        const r = await fetch(BACKEND + "/ping");
        const j = await r.json();
        line("ping", JSON.stringify(j));
      } catch (e) {
        line("ping-error", e.message);
      }
    }

    async function onSend() {
      const text = input.value.trim();
      if (!text) return;

      line("you", text);
      input.value = "";
      send.disabled = true;

      try {
        const r = await fetch(BACKEND + "/chat", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ text })
        });

        const j = await r.json();
        if (!r.ok) throw new Error(j.detail  ("HTTP " + r.status));

        line("server", j.answer  "(Ğ¿ÑƒÑÑ‚Ğ¾)");
      } catch (e) {
        line("error", e.message);
      } finally {
        send.disabled = false;
        input.focus();
      }
    }

    send.addEventListener("click", onSend);
    input.addEventListener("keydown", (e) => { if (e.key === "Enter") onSend(); });

    line("system", "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾. ĞŸĞ¸ÑˆĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ğŸ‘‡");
    ping();
  </script>
</body>
</html>