<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MiniGPT</title>
</head>
<body style="margin:0; padding:16px; font-family: Arial, sans-serif;">
<div style="border:3px solid lime; padding:10px; border-radius:10px;">
  HTML UPDATED ‚úÖ
</div>

<script>
  document.body.insertAdjacentHTML("beforeend",
    "<div style='border:3px solid deepskyblue; padding:10px; border-radius:10px; margin-top:10px;'>JS RUNNING ‚úÖ</div>"
  );
</script>
  <div style="padding:10px;border:1px solid #22c55e;margin-bottom:10px;border-radius:10px;">
    ‚úÖ Mini App: backend ping + chat
  </div>

  <div id="chat" style="height:60vh; overflow:auto; border:1px solid #ccc; padding:10px; border-radius:10px;"></div>

  <div style="display:flex; gap:8px; margin-top:10px;">
      <label for="msg"></label><input id="msg" style="flex:1; padding:10px; border:1px solid #ccc; border-radius:10px;" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
    <button id="send" style="padding:10px 16px; border:1px solid #ccc; border-radius:10px;">Send</button>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  const BACKEND = "https://tg-mini-gpt-backend.onrender.com"; // Render ‚úÖ

  const chat = document.getElementById("chat");
  const input = document.getElementById("msg");
  const send  = document.getElementById("send");

  function line(who, text) {
    const p = document.createElement("p");
    p.textContent = ${who}: ${text};
    p.style.margin = "6px 0";
    chat.appendChild(p);
    chat.scrollTop = chat.scrollHeight;
  }

  // –ó–∞—â–∏—Ç–∞ –æ—Ç "–Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è"
  if (!chat  !input  !send) {
    document.body.insertAdjacentHTML("beforeend",
      "<div style='border:3px solid red; padding:10px; border-radius:10px;'>–û–®–ò–ë–ö–ê: –Ω–µ—Ç chat/msg/send –≤ HTML</div>"
    );
    throw new Error("Missing elements chat/msg/send");
  }

  // Telegram init
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.ready(); tg.expand(); line("system", "Telegram WebApp ‚úÖ"); }
  else { line("system", "–û—Ç–∫—Ä—ã—Ç–æ –Ω–µ –≤ Telegram"); }

  line("debug", "BACKEND=" + BACKEND);

  async function ping() {
    try {
      const r = await fetch(BACKEND + "/ping");
      const j = await r.json();
      line("ping", JSON.stringify(j));
    } catch (e) {
      line("ping-error", e.message);
    }
  }

  async function onSend() {
    const text = input.value.trim();
    if (!text) return;

    line("you", text);
    input.value = "";
    send.disabled = true;

    try {
      const r = await fetch(BACKEND + "/chat", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ text })
      });

      const j = await r.json();
      if (!r.ok) throw new Error(j.detail  ("HTTP " + r.status));

      line("server", j.answer  "(–ø—É—Å—Ç–æ)");
    } catch (e) {
      line("error", e.message);
    } finally {
      send.disabled = false;
      input.focus();
    }
  }

  send.addEventListener("click", onSend);
  input.addEventListener("keydown", (e) => { if (e.key === "Enter") onSend(); });

  line("system", "–ì–æ—Ç–æ–≤–æ. –ü–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ üëá");
  ping();
</script>
</body>
</html>
